#!/usr/bin/env node
const storage=require('./storage');const VERSION='0.1.0';function showHelp(){console.log('MoltManager - Manage your AI agent zoo, locally');console.log('');console.log('Usage: molt [command] [options]');console.log('');console.log('Commands:');console.log('  create [n] [prompt]     Create a new moltbot');console.log('  list                       List all moltbots');console.log('  show [n]                Show moltbot details');console.log('  edit [n] [prompt]       Update system prompt');console.log('  delete [n]              Remove a moltbot');console.log('  rename [old] [new]         Rename a moltbot');console.log('  copy [n]                Copy system prompt');console.log('  search [query]             Search moltbots');console.log('  tags                       List all tags');console.log('  export [n]              Export to JSON');console.log('  import [file]              Import from JSON');console.log('  backup                     Backup all moltbots');console.log('  stats                      Show statistics');console.log('  storage                    Show storage location');console.log('  help                       Show this help');console.log('  version                    Show version');console.log('');console.log('Examples:');console.log('  molt create python-tutor "You are a patient Python teacher..."');console.log('  molt create code-reviewer "..." --tag coding');console.log('  molt list --tag coding');console.log('  molt copy python-tutor');}function parseTags(a){const t=[];for(let i=0;i<a.length;i++){if(a[i]==='--tag'&&i+1<a.length)t.push(a[i+1]);}return t}function parseModel(a){for(let i=0;i<a.length;i++){if(a[i]==='--model'&&i+1<a.length)return a[i+1];}return 'claude-sonnet-4'}function handleCreate(a){if(a.length<2){console.error('Error: Provide name and system prompt');process.exit(1);}const n=a[0];const p=a[1];const t=parseTags(a.slice(2));const m=parseModel(a.slice(2));try{const mb=storage.createMoltbot(n,p,t,m);console.log('Created moltbot: '+mb.name);if(t.length>0)console.log('Tags: '+t.join(', '));}catch(e){console.error('Failed:',e.message);process.exit(1);}}function handleList(a){let tf=null;for(let i=0;i<a.length;i++){if(a[i]==='--tag'&&i+1<a.length)tf=a[i+1];}const m=storage.listMoltbots(tf);if(m.length===0){console.log(tf?'No moltbots with tag "'+tf+'"':'No moltbots yet');return;}console.log(tf?'Moltbots with tag "'+tf+'":':'Your Moltbots:');console.log('');m.forEach(mb=>{const ts=mb.tags&&mb.tags.length>0?' ['+mb.tags.join(', ')+']':'';const pr=mb.systemPrompt.length>60?mb.systemPrompt.substring(0,60)+'...':mb.systemPrompt;console.log(mb.id+'. '+mb.name+ts);console.log('   '+pr);});}function handleShow(a){if(a.length===0){console.error('Error: Provide moltbot name');process.exit(1);}const mb=storage.getMoltbot(a[0]);if(!mb){console.error('Moltbot "'+a[0]+'" not found');process.exit(1);}console.log('Moltbot: '+mb.name);console.log('ID: '+mb.id);console.log('Model: '+mb.model);if(mb.tags&&mb.tags.length>0)console.log('Tags: '+mb.tags.join(', '));console.log('');console.log('System Prompt:');console.log(mb.systemPrompt);}function handleEdit(a){if(a.length<2){console.error('Error: Provide name and new prompt');process.exit(1);}const u=storage.updateMoltbot(a[0],{systemPrompt:a[1]});if(!u){console.error('Moltbot "'+a[0]+'" not found');process.exit(1);}console.log('Updated: '+a[0]);}function handleDelete(a){if(a.length===0){console.error('Error: Provide name');process.exit(1);}if(!storage.deleteMoltbot(a[0])){console.error('Moltbot "'+a[0]+'" not found');process.exit(1);}console.log('Deleted: '+a[0]);}function handleRename(a){if(a.length<2){console.error('Error: Provide old and new name');process.exit(1);}try{const r=storage.renameMoltbot(a[0],a[1]);if(!r){console.error('Moltbot "'+a[0]+'" not found');process.exit(1);}console.log('Renamed "'+a[0]+'" to "'+a[1]+'"');}catch(e){console.error('Failed:',e.message);process.exit(1);}}function handleCopy(a){if(a.length===0){console.error('Error: Provide name');process.exit(1);}const mb=storage.getMoltbot(a[0]);if(!mb){console.error('Moltbot "'+a[0]+'" not found');process.exit(1);}storage.updateMoltbot(a[0],{});console.log(mb.systemPrompt);}function handleSearch(a){if(a.length===0){console.error('Error: Provide query');process.exit(1);}const r=storage.searchMoltbots(a[0]);if(r.length===0){console.log('No moltbots found matching "'+a[0]+'"');return;}console.log('Found '+r.length+' moltbot(s):');console.log('');r.forEach(m=>console.log(m.id+'. '+m.name));}function handleTags(){const t=storage.getAllTags();if(t.length===0){console.log('No tags yet');return;}console.log('All tags:');console.log('');t.forEach(tag=>console.log('  '+tag));}function handleExport(a){if(a.length===0){console.error('Error: Provide name');process.exit(1);}const j=storage.exportMoltbot(a[0]);if(!j){console.error('Moltbot "'+a[0]+'" not found');process.exit(1);}console.log(j);}function handleImport(a){if(a.length===0){console.error('Error: Provide file path');process.exit(1);}try{const fs=require('fs');const j=fs.readFileSync(a[0],'utf-8');const mb=storage.importMoltbot(j);console.log('Imported: '+mb.name);}catch(e){console.error('Failed:',e.message);process.exit(1);}}function handleBackup(){console.log(storage.backupAll());}function handleStats(){const s=storage.getStats();console.log('MoltManager Statistics');console.log('');console.log('Total Moltbots: '+s.total);console.log('Total Tags: '+s.tags);if(s.mostRecent)console.log('Most Recent: '+s.mostRecent);console.log('');console.log('Storage: '+storage.getStorageDir());}function handleStorage(){console.log('Storage: '+storage.getStorageDir());}async function main(){const a=process.argv.slice(2);if(a.length===0){showHelp();return;}const c=a[0];const ca=a.slice(1);switch(c){case 'create':handleCreate(ca);break;case 'list':handleList(ca);break;case 'show':handleShow(ca);break;case 'edit':handleEdit(ca);break;case 'delete':handleDelete(ca);break;case 'rename':handleRename(ca);break;case 'copy':handleCopy(ca);break;case 'info':handleShow(ca);break;case 'search':handleSearch(ca);break;case 'tags':handleTags();break;case 'export':handleExport(ca);break;case 'import':handleImport(ca);break;case 'backup':handleBackup();break;case 'stats':handleStats();break;case 'storage':handleStorage();break;case 'version':case '--version':case '-v':console.log('MoltManager v'+VERSION);break;case 'help':case '--help':case '-h':showHelp();break;default:console.error('Unknown command: '+c);process.exit(1);}}main().catch(e=>{console.error('Error:',e.message);process.exit(1);});